<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	  
<mapper namespace="com.example.project_team.mappers.AutoMapper">

<!-- 자동이체 목록 조회 -->
<select id="autoList" resultType="com.example.project_team.dto.AutoDTO">
	SELECT * FROM team_auto order by autoNum
</select>

<!-- 자동이체 상세목록  -->
<select id="autoDetail" parameterType="int" resultType="com.example.project_team.dto.AutoDTO">
	SELECT * FROM team_auto WHERE autoNum=#{autoNum} 
</select>

<!-- 자동이체 전 계좌 조회 -->
<select id="autoAccount" parameterType="String" resultType="com.example.project_team.dto.AccountDTO">
	SELECT * FROM team_account WHERE id = #{id} AND accountType = 'e' AND show = 'y'
</select>

<!-- 1건 출금 -->
<update id="outAuto" parameterType="Map">
	UPDATE team_account
	SET balance = #{out}
	WHERE accountNum = #{accountNum}
</update>

<!-- 출금 계좌 기존 잔액 가져오기  -->
<select id="mBalanceChk" parameterType="Map" resultType="int">
	SELECT balance FROM team_account WHERE accountNum = #{accountNum} 
</select>

<!-- 수취인 계좌 기존 잔액 가져오기  -->
<select id="balanceChk" parameterType="Map" resultType="int">
	SELECT balance FROM team_account WHERE accountNum = #{autoAccount} 
</select>

<!-- 자동이체 입금걸어놓기 -->
<update id="insertAuto" parameterType="Map">
	UPDATE team_account
	SET balance = #{in}
	WHERE accountNum = #{autoAccount}
</update>

<!-- 자동이체 거래목록에 추가 => 입금 완료 됐을 시-->
<insert id="addAutoList" parameterType="com.example.project_team.dto.AutoDTO">
	INSERT INTO team_auto(autoNum, id, accountNum, accountPW, balance, accountLimit , autoCompany, autoAccount, autoDate, autoAmount, autoTitle, autoResult, autoStart)
		VALUES((SELECT NVL(MAX(autoNum)+1, 100)FROM team_auto),#{id},#{accountNum}, #{accountPW}, #{balance}, #{accountLimit}, #{autoCompany}, #{autoAccount}, #{autoDate},#{autoAmount},#{autoTitle}, #{autoResult}, SYSDATE) 
</insert>

<!-- 자동이체 변경/해지 메인  -->
<select id="changeAuto" parameterType="int" resultType="com.example.project_team.dto.AutoDTO">
	SELECT * FROM team_auto order by autoNum
</select>

<!-- 자동이체 결제일 변경전 계좌 정보 가져오기 -->
<select id="alterAutoDateList" parameterType="int" resultType="com.example.project_team.dto.AutoDTO">
	SELECT * FROM team_auto WHERE autoNum=#{autoNum} 
</select>

<!-- 자동이체 결제일 변경 -->
<!-- 자동이체 출금계좌 변경 전 열람 -->
<!-- 자동이체 출금계좌 변경 -->

</mapper>